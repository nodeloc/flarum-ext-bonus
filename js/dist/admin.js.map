{"version":3,"file":"admin.js","mappings":"MACA,IAAIA,EAAsB,CCA1BA,EAAyBC,IACxB,IAAIC,EAASD,GAAUA,EAAOE,WAC7B,IAAOF,EAAiB,QACxB,IAAM,EAEP,OADAD,EAAoBI,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,CAAM,ECLdF,EAAwB,CAACM,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXP,EAAoBS,EAAEF,EAAYC,KAASR,EAAoBS,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDR,EAAwB,CAACc,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,I,mBCAlF,MAAM,EAA+BI,OAAOC,KAAKC,OAAO,c,MCExDC,GAAAA,aAAiBC,IAAI,4BAA4B,WAC/CC,QAAQC,IAAI,qDACd,ICJA,MAAM,EAA+BN,OAAOC,KAAKC,OAAO,a,aCAxD,SAASK,EAAgBC,EAAGC,GAC1B,OAAOF,EAAkBhB,OAAOmB,eAAiBnB,OAAOmB,eAAeC,OAAS,SAAUH,EAAGC,GAC3F,OAAOD,EAAEI,UAAYH,EAAGD,CAC1B,EAAGD,EAAgBC,EAAGC,EACxB,CCHA,SAASI,EAAeL,EAAGlB,GACzBkB,EAAEX,UAAYN,OAAOuB,OAAOxB,EAAEO,WAAYW,EAAEX,UAAUkB,YAAcP,EAAGE,EAAeF,EAAGlB,EAC3F,CCHA,MAAM,EAA+BU,OAAOC,KAAKC,OAAO,kC,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,4B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,8B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,sC,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,uB,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,uB,aCUnCc,EAAuB,oBAAAA,IAAA,KAAAC,EAAAD,EAAAnB,UAgHzC,OAhHyCoB,EAC1CC,OAAA,WAAS,IAAAC,EAAA,KACPC,KAAKC,MAAQ,KAEblB,IAAImB,QAAQ,CACVC,OAAQ,MACRC,IAAKrB,IAAIsB,MAAMC,UAAU,UAAY,gBACpCC,MAAK,SAAAC,GACNT,EAAKE,MAAQlB,IAAI0B,MAAMC,YAAYF,GACnCG,EAAEC,QACJ,GACF,EAACf,EAEDgB,KAAA,WAAO,IAAAC,EAAA,KACCC,EAAgC,OAAff,KAAKC,MAAiB,GAAKD,KAAKC,MAAMe,KAAI,SAAAC,GAAI,OAAIA,EAAKC,QAAQC,IAAI,IACpFC,EAAgB,CACpB,EAAK,MACL,EAAK,MAEP,OAAOT,EAAE,uBAAwBA,EAAE,QAAS,CAC3B,OAAfX,KAAKC,MAAiBU,EAAE,KAAMA,EAAE,KAAMU,IAAAA,cAAiCrB,KAAKC,MAAMe,KAAI,SAACC,EAAMK,GAAK,OAAKX,EAAE,KAAM,CAC7GA,EAAE,KAAMM,EAAKC,QAAQK,cACrBZ,EAAE,KAAMA,EAAE,oBAAqB,CAC7Ba,KAAM,SACNC,IAAK,EACLC,KAAM,MACNC,SAAU,SAAAC,GACRX,EAAKY,KAAK,CACRC,OAAQF,EAAMG,OAAOC,QACpBzB,MAAK,WACNI,EAAEC,QACJ,GACF,EACAoB,MAAOf,EAAKa,YAEdnB,EAAE,KAAMA,EAAE,oBAAqB,CAC7BgB,SAAU,SAAAC,GACRX,EAAKY,KAAK,CACRI,QAASL,EAAMG,OAAOC,QACrBzB,MAAK,WACNI,EAAEC,QACJ,GACF,EACAoB,MAAOf,EAAKgB,aAEdtB,EAAE,KAAMA,EAAE,qBAAsB,CAC9BgB,SAAU,SAAAC,GACRX,EAAKY,KAAK,CACRK,cAAeN,EAAMG,OAAOC,QAC3BzB,MAAK,WACNI,EAAEC,QACJ,GACF,EACAoB,MAAOf,EAAKX,UAAU,kBAAoB,KACzCnC,OAAOgE,QAAQf,GAAeJ,KAAI,SAAAoB,GAAA,IAAEJ,EAAKI,EAAA,GAAEC,EAAKD,EAAA,UACjDzB,EAAE,SAAU,CAAEqB,MAAAA,GAASK,EAAM,MAE/B1B,EAAE,KAAMA,EAAE,oBAAqB,CAC7Ba,KAAM,iBACNG,SAAU,SAAAC,GACRX,EAAKY,KAAK,CACRS,cAAeV,EAAMG,OAAOC,QAC3BzB,MAAK,WACNI,EAAEC,QACJ,GACF,EACAoB,MAAOf,EAAKX,UAAU,mBAAoB,IAAIiC,MAAOC,cAAcC,MAAM,EAAG,OAE9E9B,EAAE,KAAMA,EAAE,+BAAgC,CACxC+B,QAAS,SAAAd,GACPA,EAAMe,iBACN1B,EAAI,SAAUV,MAAK,WACjBO,EAAKb,MAAM2C,OAAOtB,EAAO,GACzBX,EAAEC,QACJ,GACF,GACCiC,IAAK,mBACR,IACFlC,EAAE,KAAMA,EAAE,KAAM,CACdmC,QAAS,GACRC,IAAAA,UAAmB,CACpBV,MAAOtD,IAAIiE,WAAWC,MAAMC,iCAC5BC,gBAAiB,UAChBpE,IAAI0B,MAAM2C,IAAI,UACdC,QAAO,SAAAnC,GACN,OAAIA,EAAMC,OAASmC,IAAAA,WAAmBpC,EAAMC,OAASmC,IAAAA,WAMN,IAAxCvC,EAAewC,QAAQrC,EAAMC,KACtC,IACCH,KAAI,SAAAE,GAAK,OAAIsC,IAAAA,UAAiB,CAC7Bd,QAAS,WACP3D,IAAImB,QAAQ,CACVC,OAAQ,OACRC,IAAKrB,IAAIsB,MAAMC,UAAU,UAAY,oBACrCmD,KAAM,CACJC,KAAM,CACJC,WAAY,CACVC,QAAS1C,EAAMC,UAIpBZ,MAAK,SAAAC,GACNM,EAAKb,MAAM4D,KAAK9E,IAAI0B,MAAMC,YAAYF,IACtCG,EAAEC,QACJ,GACF,GACCM,EAAMK,aAAa,SAE5B,EAAC3B,CAAA,CAhHyC,GCRvBkE,EAAyB,SAAAC,GAAA,SAAAD,IAAA,OAAAC,EAAAC,MAAA,KAAAC,YAAA,KAK3C,OAL2CxE,EAAAqE,EAAAC,GAAAD,EAAArF,UAC5CwD,QAAA,WACE,OAAOtB,EAAE,0BAA2BA,EAAE,aAAc,CAClDA,EAAE,cAAeA,EAAEuD,MAEvB,EAACJ,CAAA,CAL2C,CAASK,KCFvD,MAAM,EAA+BvF,OAAOC,KAAKC,OAAO,gB,aCEnCsF,EAAa,SAAAC,GAAA,SAAAD,IAAA,QAAArE,EAAAuE,EAAAL,UAAAM,OAAAC,EAAA,IAAAC,MAAAH,GAAAI,EAAA,EAAAA,EAAAJ,EAAAI,IAAAF,EAAAE,GAAAT,UAAAS,GAKH,OALG3E,EAAAsE,EAAA1F,KAAAqF,MAAAK,EAAA,OAAAM,OAAAH,KAAA,MAChCvC,QAAU2C,IAAAA,UAAgB,WAAU7E,EACpC+B,OAAS8C,IAAAA,UAAgB,UAAS7E,EAClCmC,cAAgB0C,IAAAA,UAAgB,iBAAgB7E,EAChDuC,cAAgBsC,IAAAA,UAAgB,iBAAgB7E,EAChDmB,MAAQ0D,IAAAA,OAAa,SAAQ7E,CAAA,QAAAN,EAAA2E,EAAAC,GAAAD,CAAA,CALG,CAASQ,KCE3C7F,IAAAA,aAAiBC,IAAI,4BAA4B,WAC/CD,IAAAA,MAAU8F,OAAO,oBAAsBT,EAEvCrF,IAAAA,cAAiB,IACV,iBACJ+F,aAAahB,EAClB,G","sources":["webpack://@nodeloc/flarum-ext-bonus/webpack/bootstrap","webpack://@nodeloc/flarum-ext-bonus/webpack/runtime/compat get default export","webpack://@nodeloc/flarum-ext-bonus/webpack/runtime/define property getters","webpack://@nodeloc/flarum-ext-bonus/webpack/runtime/hasOwnProperty shorthand","webpack://@nodeloc/flarum-ext-bonus/external root \"flarum.core.compat['common/app']\"","webpack://@nodeloc/flarum-ext-bonus/./src/common/index.js","webpack://@nodeloc/flarum-ext-bonus/external root \"flarum.core.compat['admin/app']\"","webpack://@nodeloc/flarum-ext-bonus/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@nodeloc/flarum-ext-bonus/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@nodeloc/flarum-ext-bonus/external root \"flarum.core.compat['admin/components/ExtensionPage']\"","webpack://@nodeloc/flarum-ext-bonus/external root \"flarum.core.compat['common/components/Button']\"","webpack://@nodeloc/flarum-ext-bonus/external root \"flarum.core.compat['common/components/Dropdown']\"","webpack://@nodeloc/flarum-ext-bonus/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@nodeloc/flarum-ext-bonus/external root \"flarum.core.compat['common/models/Group']\"","webpack://@nodeloc/flarum-ext-bonus/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@nodeloc/flarum-ext-bonus/./src/admin/components/BonusListConfigurator.js","webpack://@nodeloc/flarum-ext-bonus/./src/admin/components/MoneyScheduleSettingsPage.js","webpack://@nodeloc/flarum-ext-bonus/external root \"flarum.core.compat['common/Model']\"","webpack://@nodeloc/flarum-ext-bonus/./src/common/models/BonusListItem.js","webpack://@nodeloc/flarum-ext-bonus/./src/admin/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","import app from 'flarum/common/app';\n\napp.initializers.add('nodeloc/flarum-ext-bonus', () => {\n  console.log('[nodeloc/flarum-ext-bonus] Hello, forum and admin!');\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/app'];","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/components/ExtensionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Dropdown'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Group'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","import Button from 'flarum/common/components/Button';\nimport Dropdown from 'flarum/common/components/Dropdown';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport Group from 'flarum/common/models/Group';\nimport icon from 'flarum/common/helpers/icon';\n\n/* global app, m */\n\nconst translationPrefix = 'nodeloc-bonus.admin.items.';\n\nexport default class SelectFieldOptionEditor {\n  oninit() {\n    this.items = null;\n\n    app.request({\n      method: 'GET',\n      url: app.forum.attribute('apiUrl') + '/bonus-list',\n    }).then(response => {\n      this.items = app.store.pushPayload(response);\n      m.redraw();\n    });\n  }\n\n  view() {\n    const existingGroups = this.items === null ? [] : this.items.map(item => item.group().id());\n    const scheduleTypes = {\n      '0': '一次性',\n      '1': '每月',\n    };\n    return m('table.BonusListTable', m('tbody', [\n      this.items === null ? m('tr', m('td', LoadingIndicator.component())) : this.items.map((item, index) => m('tr', [\n        m('td', item.group().namePlural()),\n        m('td', m('input.FormControl', {\n          type: 'number',\n          min: 0,\n          step: 'any',\n          onchange: event => {\n            item.save({\n              amount: event.target.value,\n            }).then(() => {\n              m.redraw();\n            });\n          },\n          value: item.amount(),\n        })),\n        m('td', m('input.FormControl', {\n          onchange: event => {\n            item.save({\n              content: event.target.value,\n            }).then(() => {\n              m.redraw();\n            });\n          },\n          value: item.content(),\n        })),\n        m('td', m('select.FormControl', {\n          onchange: event => {\n            item.save({\n              schedule_type: event.target.value,\n            }).then(() => {\n              m.redraw();\n            });\n          },\n          value: item.attribute('schedule_type') || '0',\n        }, Object.entries(scheduleTypes).map(([value, label]) =>\n          m('option', { value }, label)\n        ))),\n        m('td', m('input.FormControl', {\n          type: 'datetime-local',\n          onchange: event => {\n            item.save({\n              schedule_time: event.target.value,\n            }).then(() => {\n              m.redraw();\n            });\n          },\n          value: item.attribute('schedule_time') || new Date().toISOString().slice(0, 16),\n        })),\n        m('td', m('button.Button.Button--danger', {\n          onclick: event => {\n            event.preventDefault(); // Do not close the settings modal\n            item.delete().then(() => {\n              this.items.splice(index, 1);\n              m.redraw();\n            });\n          },\n        }, icon('fas fa-times'))),\n      ])),\n      m('tr', m('td', {\n        colspan: 5,\n      }, Dropdown.component({\n        label: app.translator.trans(translationPrefix + 'add'),\n        buttonClassName: 'Button',\n      }, app.store.all('groups')\n        .filter(group => {\n          if (group.id() === Group.MEMBER_ID || group.id() === Group.GUEST_ID) {\n            // Do not suggest \"virtual\" groups\n            return false;\n          }\n\n          // Do not suggest groups already in use\n          return existingGroups.indexOf(group.id()) === -1;\n        })\n        .map(group => Button.component({\n          onclick: () => {\n            app.request({\n              method: 'POST',\n              url: app.forum.attribute('apiUrl') + '/bonus-list-items',\n              body: {\n                data: {\n                  attributes: {\n                    groupId: group.id()\n                  },\n                },\n              },\n            }).then(response => {\n              this.items.push(app.store.pushPayload(response));\n              m.redraw();\n            });\n          },\n        }, group.namePlural()))))),\n    ]));\n  }\n}\n","import ExtensionPage from 'flarum/admin/components/ExtensionPage';\nimport BonusListConfigurator from './BonusListConfigurator'\nexport default class MoneyScheduleSettingsPage extends ExtensionPage {\n  content() {\n    return m('.ExtensionPage-settings', m('.container', [\n      m('.Form-group', m(BonusListConfigurator)),\n    ]));\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","import Model from 'flarum/common/Model';\n\nexport default class BonusListItem extends Model {\n  content = Model.attribute('content');\n  amount = Model.attribute('amount');\n  schedule_type = Model.attribute('schedule_type');\n  schedule_time = Model.attribute('schedule_time');\n  group = Model.hasOne('group');\n}\n","import app from 'flarum/admin/app';\nimport MoneyScheduleSettingsPage from './components/MoneyScheduleSettingsPage';\nimport BonusListItem from \"../common/models/BonusListItem\";\n\napp.initializers.add('nodeloc/flarum-ext-bonus', () => {\n  app.store.models['bonus-list-items'] = BonusListItem;\n\n  app.extensionData\n    .for('nodeloc-bonus')\n    .registerPage(MoneyScheduleSettingsPage);\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","app","add","console","log","_setPrototypeOf","t","e","setPrototypeOf","bind","__proto__","_inheritsLoose","create","constructor","SelectFieldOptionEditor","_proto","oninit","_this","this","items","request","method","url","forum","attribute","then","response","store","pushPayload","m","redraw","view","_this2","existingGroups","map","item","group","id","scheduleTypes","LoadingIndicator","index","namePlural","type","min","step","onchange","event","save","amount","target","value","content","schedule_type","entries","_ref","label","schedule_time","Date","toISOString","slice","onclick","preventDefault","splice","icon","colspan","Dropdown","translator","trans","translationPrefix","buttonClassName","all","filter","Group","indexOf","Button","body","data","attributes","groupId","push","MoneyScheduleSettingsPage","_ExtensionPage","apply","arguments","BonusListConfigurator","ExtensionPage","BonusListItem","_Model","_len","length","args","Array","_key","concat","Model","models","registerPage"],"sourceRoot":""}