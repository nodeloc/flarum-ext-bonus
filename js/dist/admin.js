(()=>{var t={n:n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},d:(n,e)=>{for(var o in e)t.o(e,o)&&!t.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:e[o]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n)};(()=>{"use strict";const n=flarum.core.compat["common/app"];t.n(n)().initializers.add("nodeloc/flarum-ext-bonus",(function(){console.log("[nodeloc/flarum-ext-bonus] Hello, forum and admin!")}));const e=flarum.core.compat["admin/app"];var o=t.n(e);function r(t,n){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},r(t,n)}function a(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,r(t,n)}const u=flarum.core.compat["admin/components/ExtensionPage"];var c=t.n(u);const i=flarum.core.compat["common/components/Button"];var s=t.n(i);const l=flarum.core.compat["common/components/Dropdown"];var p=t.n(l);const d=flarum.core.compat["common/components/LoadingIndicator"];var f=t.n(d);const h=flarum.core.compat["common/models/Group"];var b=t.n(h);const v=flarum.core.compat["common/helpers/icon"];var g=t.n(v),y=function(){function t(){}var n=t.prototype;return n.oninit=function(){var t=this;this.items=null,app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/bonus-list"}).then((function(n){t.items=app.store.pushPayload(n),m.redraw()}))},n.view=function(){var t=this,n=null===this.items?[]:this.items.map((function(t){return t.group().id()})),e={0:"一次性",1:"每月"};return m("table.BonusListTable",m("tbody",[null===this.items?m("tr",m("td",f().component())):this.items.map((function(n,o){return m("tr",[m("td",n.group().namePlural()),m("td",m("input.FormControl",{type:"number",min:0,step:"any",onchange:function(t){n.save({amount:t.target.value}).then((function(){m.redraw()}))},value:n.amount()})),m("td",m("input.FormControl",{onchange:function(t){n.save({content:t.target.value}).then((function(){m.redraw()}))},value:n.content()})),m("td",m("select.FormControl",{onchange:function(t){n.save({schedule_type:t.target.value}).then((function(){m.redraw()}))},value:n.attribute("schedule_type")||"0"},Object.entries(e).map((function(t){var n=t[0],e=t[1];return m("option",{value:n},e)})))),m("td",m("input.FormControl",{type:"datetime-local",onchange:function(t){n.save({schedule_time:t.target.value}).then((function(){m.redraw()}))},value:n.attribute("schedule_time")||(new Date).toISOString().slice(0,16)})),m("td",m("button.Button.Button--danger",{onclick:function(e){e.preventDefault(),n.delete().then((function(){t.items.splice(o,1),m.redraw()}))}},g()("fas fa-times")))])})),m("tr",m("td",{colspan:5},p().component({label:app.translator.trans("nodeloc-bonus.admin.items.add"),buttonClassName:"Button"},app.store.all("groups").filter((function(t){return t.id()!==b().MEMBER_ID&&t.id()!==b().GUEST_ID&&-1===n.indexOf(t.id())})).map((function(n){return s().component({onclick:function(){app.request({method:"POST",url:app.forum.attribute("apiUrl")+"/bonus-list-items",body:{data:{attributes:{groupId:n.id()}}}}).then((function(n){t.items.push(app.store.pushPayload(n)),m.redraw()}))}},n.namePlural())})))))]))},t}(),_=function(t){function n(){return t.apply(this,arguments)||this}return a(n,t),n.prototype.content=function(){return m(".ExtensionPage-settings",m(".container",[m(".Form-group",m(y))]))},n}(c());const O=flarum.core.compat["common/Model"];var w=t.n(O),P=function(t){function n(){for(var n,e=arguments.length,o=new Array(e),r=0;r<e;r++)o[r]=arguments[r];return(n=t.call.apply(t,[this].concat(o))||this).content=w().attribute("content"),n.amount=w().attribute("amount"),n.schedule_type=w().attribute("schedule_type"),n.schedule_time=w().attribute("schedule_time"),n.group=w().hasOne("group"),n}return a(n,t),n}(w());o().initializers.add("nodeloc/flarum-ext-bonus",(function(){o().store.models["bonus-list-items"]=P,o().extensionData.for("nodeloc-bonus").registerPage(_)}))})(),module.exports={}})();
//# sourceMappingURL=admin.js.map